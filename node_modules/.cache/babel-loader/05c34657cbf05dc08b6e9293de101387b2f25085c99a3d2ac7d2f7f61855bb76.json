{"ast":null,"code":"// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\nexport function createSingletonHandler(factory) {\n  const listeners = [];\n  const callback = value => {\n    unstable_batchedUpdates(() => {\n      for (const listener of listeners) {\n        listener(value);\n      }\n    });\n  };\n  let cleanup;\n  return function useSingleton(listener) {\n    useEffect(() => {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n      listeners.push(listener);\n      return () => {\n        listeners.splice(listeners.indexOf(listener), 1);\n        if (listeners.length === 0) {\n          cleanup();\n          cleanup = undefined;\n        }\n      };\n      // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\nexport function createSingletonState(_ref) {\n  let {\n    factory,\n    initialState\n  } = _ref;\n  const useSingleton = createSingletonHandler(factory);\n  let value = initialState;\n  return function useSingletonState() {\n    const [state, setState] = useState(value);\n    useSingleton(newValue => {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}","map":{"version":3,"names":["useEffect","useState","unstable_batchedUpdates","createSingletonHandler","factory","listeners","callback","value","listener","cleanup","useSingleton","length","push","splice","indexOf","undefined","createSingletonState","_ref","initialState","useSingletonState","state","setState","newValue"],"sources":["/Users/ndwang/Documents/projects/face2alias_aws/node_modules/@cloudscape-design/components/internal/hooks/use-singleton-handler/lib/default/internal/hooks/use-singleton-handler/index.ts"],"sourcesContent":["// Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.\n// SPDX-License-Identifier: Apache-2.0\nimport { useEffect, useState } from 'react';\nimport { unstable_batchedUpdates } from 'react-dom';\n\ntype ValueCallback<T> = (value: T) => void;\ntype CleanupCallback = () => void;\nexport type UseSingleton<T> = (listener: ValueCallback<T>) => void;\n\nexport function createSingletonHandler<T>(factory: (handler: ValueCallback<T>) => CleanupCallback): UseSingleton<T> {\n  const listeners: Array<ValueCallback<T>> = [];\n  const callback: ValueCallback<T> = value => {\n    unstable_batchedUpdates(() => {\n      for (const listener of listeners) {\n        listener(value);\n      }\n    });\n  };\n  let cleanup: (() => void) | undefined;\n\n  return function useSingleton(listener: ValueCallback<T>) {\n    useEffect(() => {\n      if (listeners.length === 0) {\n        cleanup = factory(callback);\n      }\n      listeners.push(listener);\n\n      return () => {\n        listeners.splice(listeners.indexOf(listener), 1);\n        if (listeners.length === 0) {\n          cleanup!();\n          cleanup = undefined;\n        }\n      };\n      // register handlers only on mount\n      // eslint-disable-next-line react-hooks/exhaustive-deps\n    }, []);\n  };\n}\n\ninterface SingletonStateOptions<T> {\n  factory: (handler: ValueCallback<T>) => CleanupCallback;\n  initialState: T | (() => T); // useState signature\n}\n\nexport function createSingletonState<T>({ factory, initialState }: SingletonStateOptions<T>) {\n  const useSingleton = createSingletonHandler(factory);\n  let value = initialState;\n  return function useSingletonState() {\n    const [state, setState] = useState<T>(value);\n    useSingleton(newValue => {\n      value = newValue;\n      setState(newValue);\n    });\n    return state;\n  };\n}\n"],"mappings":"AAAA;AACA;AACA,SAASA,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAC3C,SAASC,uBAAuB,QAAQ,WAAW;AAMnD,OAAM,SAAUC,sBAAsBA,CAAIC,OAAuD;EAC/F,MAAMC,SAAS,GAA4B,EAAE;EAC7C,MAAMC,QAAQ,GAAqBC,KAAK,IAAG;IACzCL,uBAAuB,CAAC,MAAK;MAC3B,KAAK,MAAMM,QAAQ,IAAIH,SAAS,EAAE;QAChCG,QAAQ,CAACD,KAAK,CAAC;;IAEnB,CAAC,CAAC;EACJ,CAAC;EACD,IAAIE,OAAiC;EAErC,OAAO,SAASC,YAAYA,CAACF,QAA0B;IACrDR,SAAS,CAAC,MAAK;MACb,IAAIK,SAAS,CAACM,MAAM,KAAK,CAAC,EAAE;QAC1BF,OAAO,GAAGL,OAAO,CAACE,QAAQ,CAAC;;MAE7BD,SAAS,CAACO,IAAI,CAACJ,QAAQ,CAAC;MAExB,OAAO,MAAK;QACVH,SAAS,CAACQ,MAAM,CAACR,SAAS,CAACS,OAAO,CAACN,QAAQ,CAAC,EAAE,CAAC,CAAC;QAChD,IAAIH,SAAS,CAACM,MAAM,KAAK,CAAC,EAAE;UAC1BF,OAAQ,EAAE;UACVA,OAAO,GAAGM,SAAS;;MAEvB,CAAC;MACD;MACA;IACF,CAAC,EAAE,EAAE,CAAC;EACR,CAAC;AACH;AAOA,OAAM,SAAUC,oBAAoBA,CAAAC,IAAA,EAAuD;EAAA,IAAnD;IAAEb,OAAO;IAAEc;EAAY,CAA4B,GAAAD,IAAA;EACzF,MAAMP,YAAY,GAAGP,sBAAsB,CAACC,OAAO,CAAC;EACpD,IAAIG,KAAK,GAAGW,YAAY;EACxB,OAAO,SAASC,iBAAiBA,CAAA;IAC/B,MAAM,CAACC,KAAK,EAAEC,QAAQ,CAAC,GAAGpB,QAAQ,CAAIM,KAAK,CAAC;IAC5CG,YAAY,CAACY,QAAQ,IAAG;MACtBf,KAAK,GAAGe,QAAQ;MAChBD,QAAQ,CAACC,QAAQ,CAAC;IACpB,CAAC,CAAC;IACF,OAAOF,KAAK;EACd,CAAC;AACH"},"metadata":{},"sourceType":"module","externalDependencies":[]}